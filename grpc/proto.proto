syntax = "proto3";
option go_package = "Auction/grpc/proto";

message Empty {}

/* For service discovery */
message Node {
    int32 port = 67;
}

message Nodes {
    repeated int32 port = 6767;
}

/* Elections */
message Request {
    int32 port = 676767;
}

/* Bidding */
enum State {
    SUCCESS = 0;
    FAIL = 1;
    EXCEPTION = 2;
}

message Bid {
    int32 port = 1;
    int32 amount = 2;
}

message Ack {
    State state = 3;
}

message Update {
    int32 timestamp = 4;
    int32 amount = 5;
    int32 bidder_port = 6;
}

message Result {
    bool done = 7;
    int32 winner_port = 8;
    int32 highest_bid = 9;
}

service AuctionNodeService {
    // Service discovery
    rpc Announce (Node) returns (Empty) {};
    rpc GetNodes (Empty) returns (Nodes) {};
    rpc Ready (Empty) returns (Empty) {};

    // The bully 
    rpc Election (Empty) returns (Empty) {};
    rpc Coordinator (Request) returns (Empty) {};
    rpc GetCoordinator (Empty) returns (Request) {};

    // Auction
    rpc SendBid (Bid) returns (Ack) {};
    rpc GetResult (Empty) returns (Result) {};

    // Replication
    rpc SendUpdate (Update) returns (Empty) {};
    rpc Ping (Empty) returns (Empty) {};
}